beanstalk:
  image: schickling/beanstalkd
  restart: always
  
downloader_cache_dv:
  image: downloader
  command: ["true"]
  volumes:
    - ./cache:/tmp/cache/

downloader:
  image: downloader
  restart: always
  environment:
    BEANSTALK_HOST: beanstalk
    BEANSTALK_DOWNLOAD_QUEUE: downloadRequestTube
    BEANSTALK_FEEDBACKOK_QUEUE: feedbackOkTube
    BEANSTALK_FEEDBACKERROR_QUEUE: feedbackErrorTube
    ZIP_CACHEPATH: /tmp/cache
  volumes_from:
    - downloader_cache_dv
  links:
    - beanstalk

feedback_ok:
  image: feedback
  restart: always
  environment:
    BEANSTALK_HOST: beanstalk
    BEANSTALK_FEEDBACK_QUEUE: feedbackOkTube
    SMTP_HOST: mail.your-server.de
    SMTP_PORT: 25
    EMAIL_MESSAGE_TEMPLATE: |
      "Geachte $${username}, 
      
      U kunt bestand $${featuretype}.zip downloaden via de volgende link: 
      $${downloadlink}. "
    EMAIL_SUBJECT_TEMPLATE: "Uw download aanvraag '$${featuretype}' van Geoportaal Overijssel staat gereed"
    DOWNLOAD_URL: "https://test.geoportaaloverijssel.nl/download-result"
    DB_USER: postgres
    DB_PW: postgres
    DB_URL: "jdbc:postgresql://db:5432/download"
  links:
    - db
    - beanstalk

feedback_error:
  image: feedback
  restart: always
  environment:
    BEANSTALK_HOST: beanstalk
    BEANSTALK_FEEDBACK_QUEUE: feedbackErrorTube
    SMTP_HOST: mail.your-server.de
    SMTP_PORT: 25
    EMAIL_MESSAGE_TEMPLATE: |
      "Geachte $${username}, 
      
      Uw download $${featuretype} van Geoportaal Overijssel is niet gelukt.
      De foutcode is:
        $${responsecode}
      Neem voor meer informatie contact op met Geoportaal Overijssel. "
    EMAIL_SUBJECT_TEMPLATE: "Uw download aanvraag '$${featuretype}' van Geoportaal Overijssel is niet gelukt"
    DOWNLOAD_URL: "https://test.geoportaaloverijssel.nl/download-result"
    DB_USER: postgres
    DB_PW: postgres
    DB_URL: "jdbc:postgresql://db:5432/download"
  links:
    - db
    - beanstalk

request:
  image: request
  restart: always
  environment:
    BEANSTALK_HOST: beanstalk
    BEANSTALK_DOWNLOAD_QUEUE: downloadRequestTube
    DB_USER: postgres
    DB_PW: postgres
    DB_URL: "jdbc:postgresql://db:5432/download"
  links:
    - db
    - beanstalk

db:
  build: db
  restart: always

web:
  image: web
  restart: always
  environment:
    BEANSTALK_HOST: beanstalk
    BEANSTALK_DOWNLOAD_QUEUE: downloadRequestTube
    METADATA_PREFIX: "http://test-metadata.geodataoverijssel.nl/metadata/dataset/"
    DB_USER: postgres
    DB_PW: postgres
    DB_URL: "jdbc:postgresql://db:5432/download"
    APPLICATION_SECRET: FgZvDqfDukyA9ZmhCBmHTmCoahULjzB4nVzfwFDU7A6wyhNTOHtWN
    ZOOKEEPER_HOST: zookeeper:2181
    SERVICE_DOMAIN_NAME: localhost
    ZIP_CACHEPATH: /tmp/cache
  external_links:
    - base-zookeeper:zookeeper
  links:
    - db
    - beanstalk
  volumes_from:
    - downloader_cache_dv

gc:
  build: gc
  restart: always
  environment:
    ZIP_CACHEPATH: /tmp/cache
  volumes_from:
    - downloader_cache_dv

